{"version":3,"sources":["newsletter.js"],"names":["client","_mongodb","require","createClient","regeneratorRuntime","async","_context","prev","next","awrap","MongoClient","connect","process","env","NEXT_MONGODB_URI","sent","abrupt","stop","handler","req","res","email","userEmail","_client","db","_context2","method","body","toLowerCase","includes","status","json","message","collection","findOne","insertOne","close","t0","config"],"mappings":"2FAAA,IAIIA,OAJJC,SAAAC,QAAA,WAUA,SAAeC,eAAf,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GANIR,OAMJ,CAAAM,EAAAE,KAAA,EAAA,MAAA,OAAAF,EAAAE,KAAA,EAAAJ,mBAAAK,MAHAC,SAAAA,YAAAC,QAAAC,QAAAC,IAAAC,mBAGA,KAAA,EAHAd,OAGAM,EAAAS,KAAA,KAAA,EAAA,OAAAT,EAAAU,OAAA,SAIShB,QAJT,KAAA,EAAA,IAAA,MAAA,OAAAM,EAAAW,UAAA,SAAAC,QAAAC,EAAAC,GAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAApB,mBAAAC,MAAA,SAAAoB,GAAA,OAAA,OAAAA,EAAAlB,KAAAkB,EAAAjB,MAAA,KAAA,EAAA,GAAA,SAAAW,EAAAO,OAAA,CAAAD,EAAAjB,KAAA,GAAA,MAAA,GAAAa,EAAAF,EAAAQ,KAAAN,OAAAC,EAAAD,EAAAO,gBAAAN,EAAAO,SAAA,MAAA,KAAAP,EAAA,CAAAG,EAAAjB,KAAA,EAAA,MAAA,OAAAiB,EAAAT,OAAA,SAAAI,EAAAU,OAAA,KAAAC,KAAA,CAAAC,QAEmBtB,0CAFnB,KAAA,EAAA,OAAAe,EAAAlB,KAAA,EAAAkB,EAAAjB,KAAA,EAAAJ,mBAAAK,MAAAN,gBAAA,KAAA,EAAA,OAAAH,EAAAyB,EAAAV,KAAAS,EAAAxB,EAAAwB,KAAAC,EAAAjB,KAAA,GAAAJ,mBAAAK,MAAAe,EAAAS,WAAA,cAAAC,QAAA,CAAAb,MAAAC,KAAA,KAAA,GAAA,GAAAG,EAAAV,KAAA,OAAAU,EAAAT,OAAA,SAAAI,EAAAU,OAAA,KAAAC,KAAA,CAAAC,QAAA,+BAAAP,EAAAjB,KAAA,GAAA,MAAA,KAAA,GAAA,OAAAiB,EAAAjB,KAAA,GAAAJ,mBAAAK,MA+BYe,EAAGS,WAAW,cAAcE,UAAU,CAACd,MAAOC,KA/B1D,KAAA,GASAtB,EAAAoC,QAAAhB,EAAAU,OAAA,KAAAC,KAAA,CAAAC,QAAA,eATAP,EAAAjB,KAAA,GAAA,MAAA,KAAA,GAAAiB,EAAAlB,KAAA,GAAAkB,EAAAY,GAAAZ,EAAA,MAAA,GASAL,EAAAU,OAAA,KAAAC,KAAA,CAAAC,QAAA,0BATA,KAAA,GAAA,IAAA,MAAA,OAAAP,EAAAR,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,MATAf,QAAQ,UAAUoC,sBAqBRhB","file":"newsletter.min.js","sourcesContent":["import {MongoClient} from 'mongodb'\nrequire('dotenv').config()\n\n\nlet client;\n\n//TODO: \n//Create a functionality that sends USER a discount code for their orders. \n//checks if user already exists and if so does not send a discount code. \n\nasync function createClient() {\n  if(!client){\n    client = await MongoClient.connect(process.env.NEXT_MONGODB_URI)\n  }\n  return client;\n}\n\n\n\nasync function handler (req, res){\n  if(req.method === 'POST'){\n    const email = req.body.email\n    const userEmail = email.toLowerCase()\n   \n    \n    if(!userEmail || !userEmail.includes('@') || userEmail === ''){\n      return res.status(422).json({message: 'Please enter a correct email address'})\n    }\n\n\n    try {\n      const client = await createClient();\n      const db = client.db();\n\n      //check if email already exists before inserting it in \n      const existingEmail = await db.collection('newsletter').findOne({email: userEmail})\n      if(existingEmail) {\n        return res.status(400).json({message:'This Email already exists'});\n      }\n      \n      //save email within the collection.\n      await db.collection('newsletter').insertOne({email: userEmail}) \n\n      client.close();\n\n      res.status(201).json({message: 'Signed up!'})\n    } catch(error) {\n      res.status(500).json({message: 'Internal server error'})\n    }\n  }\n\n  \n\n}\n\nexport default handler;"]}