"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _bcryptjs=_interopRequireDefault(require("bcryptjs")),_jsonwebtoken=_interopRequireDefault(require("jsonwebtoken")),_User=_interopRequireDefault(require("../../../models/User")),_mongoose=_interopRequireDefault(require("../../../lib/mongoose")),_cookies=_interopRequireDefault(require("cookies")),_dotenv=_interopRequireDefault(require("dotenv"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function handler(r,t){var s,n,o,a,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("POST"===r.method)return e.prev=1,s=r.body,n=s.email,o=s.password,a=n.toLowerCase().trim(),e.next=6,regeneratorRuntime.awrap(_User.default.findOne({email:a}));e.next=27;break;case 6:if(u=e.sent){e.next=10;break}return t.status(401).json({message:"User does not exist"}),e.abrupt("return");case 10:return e.next=12,regeneratorRuntime.awrap(_bcryptjs.default.compare(o,u.password));case 12:if(e.sent){e.next=15;break}return e.abrupt("return",t.status(401).json({message:"Incorrect email or password"}));case 15:i=_jsonwebtoken.default.sign({email:u.email,id:u._id.toString()},process.env.JWT_SECRET,{expiresIn:"1h"}),new _cookies.default(r,t).set("token",i,{httpOnly:!0,secure:!1,sameSite:"strict",maxAge:3600,path:"/"}),t.status(200).json({token:i,userId:u._id.toString(),message:"Login successful"}),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(1),console.log("Error saving token and storing in cookies",e.t0),t.status(500).json({message:"An internal server error occurred"});case 25:e.next=28;break;case 27:t.status(405).json({message:"Method not allowed"});case 28:case"end":return e.stop()}},null,null,[[1,21]])}_dotenv.default.config(),(0,_mongoose.default)();var _default=handler;exports.default=_default;
//# sourceMappingURL=login.min.js.map
