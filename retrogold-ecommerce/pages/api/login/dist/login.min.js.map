{"version":3,"sources":["login.js"],"names":["_bcryptjs","_interopRequireDefault","require","_jsonwebtoken","_User","_mongoose","_cookies","_dotenv","handler","req","res","_req$body","email","password","userEmail","user","token","regeneratorRuntime","async","_context","prev","next","method","body","toLowerCase","trim","awrap","User","findOne","sent","dotenv","config","message","abrupt","bcrypt","compare","status","json","jwt","sign","id","_id","toString","process","env","JWT_SECRET","expiresIn","Cookies","set","secure","sameSite","maxAge","userId","t0","console","log","stop"],"mappings":"2FAAA,IAAAA,UAAAC,uBAAAC,QAAA,aACAC,cAAAF,uBAAAC,QAAA,iBACAE,MAAAH,uBAAAC,QAAA,yBACAG,UAAAJ,uBAAAC,QAAA,0BACAI,SAAAL,uBAAAC,QAAA,YACAK,QAAAN,uBAAAC,QAAA,mFAOA,SAAeM,QAAQC,EAAKC,GAA5B,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GATA,SAAAZ,EAAAa,OASA,OAAAH,EAAAC,KAAA,EAAAT,EARAF,EAAAc,KAAAX,EAQAD,EARAC,MAAAC,EAQAF,EARAE,SAYYC,EAAYF,EAAMY,cAAcC,OAJ5CN,EAAAE,KAAA,EAAAJ,mBAAAS,MAOyBC,MAAAA,QAAKC,QAAQ,CAAEhB,MAAOE,KAP/CK,EAAAE,KAAA,GAAA,MAAA,KAAA,EAAA,GAOYN,EAPZI,EAAAU,KAAA,CAAAV,EAAAE,KAAA,GAAA,MAAA,OAJAS,EAAAA,OAAOC,KAAAA,KAAP,CAAAC,QAAA,wBAIAb,EAAAc,OAAA,UAAA,KAAA,GAAA,OAAAd,EAAAE,KAAA,GAAAJ,mBAAAS,MAAAQ,UAAAA,QAAAC,QAAAtB,EAAAE,EAAAF,WAAA,KAAA,GAAA,GAAAM,EAAAU,KAAA,CAAAV,EAAAE,KAAA,GAAA,MAAA,OAAAF,EAAAc,OAAA,SAAAvB,EAAA0B,OAAA,KAAAC,KAAA,CAAAL,QAAA,iCAAA,KAAA,GAAAhB,EAAAsB,cAAAA,QAAAC,KAAA,CAAA3B,MAAAG,EAAAH,MAAA4B,GAAAzB,EAAA0B,IAAAC,YAwBQC,QAAQC,IAAIC,WAxBpB,CAAAC,UAAA,OAAA,IAAAC,SAAAA,QAAAtC,EAAAC,GAAAsC,IAAA,QAAAhC,EAAA,CAOwCJ,UAAOE,EAATmC,QAPtC,EAiCUC,SAAU,SAjCpBC,OAAA,KAOYpC,KAPZ,MAAAL,EAAA0B,OAAA,KAAAC,KAAA,CAAArB,MAAAA,EAAAoC,OAAArC,EAAA0B,IAAAC,WAAAV,QAAA,qBAAAb,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAkC,GAAAlC,EAAA,MAAA,GAyCMmC,QAAQC,IAAI,4CAAZpC,EAAAkC,IAhCE3C,EAAAA,OAAI0B,KAAOC,KAAKA,CAAAA,QAAK,sCAT7B,KAAA,GAAAlB,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAX,EAAA0B,OAAA,KAAAC,KAAA,CAAAL,QAAA,uBAAA,KAAA,GAAA,IAAA,MAAA,OAAAb,EAAAqC,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,MAJA1B,QAAAA,QAAOC,UAPP,EAAA1B,UAAA,wBAWAG","file":"login.min.js","sourcesContent":["import bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport User from '../../../models/User';\nimport connectDB from '../../../lib/mongoose'\nimport Cookies from 'cookies'; \nimport dotenv from 'dotenv';\n\n\ndotenv.config()\nconnectDB();\n\n\nasync function handler(req, res) {\n  if(req.method === \"POST\") {\n    try {\n      const {email, password} = req.body\n      const userEmail = email.toLowerCase().trim();\n      \n     //retrieve User from database if user is there\n      const user = await User.findOne({ email: userEmail });\n      if (!user) {\n        res.status(401).json({ message: 'User does not exist' });\n        return;\n      }\n\n      //retrieve password in the user info and confirm if it matches\n      const isValidPassword = await bcrypt.compare(password, user.password)\n\n     // If the password is invalid, return a 401 Unauthorized status code\n      if (!isValidPassword) {\n        return res.status(401).json({ message: 'Incorrect email or password' });\n        \n      }\n      \n      const token = jwt.sign(\n        { email: user.email, id: user._id.toString() },\n        process.env.JWT_SECRET,\n        { expiresIn: '1h' }\n      );\n\n      \n      const cookies = new Cookies(req, res)\n      cookies.set('token', token, {\n          httpOnly: true,\n          secure: false,\n          sameSite: 'strict',\n          maxAge: 3600, // Token expiration time in seconds\n          path: '/',\n      })\n    \n      res.status(200).json({ token: token, userId: user._id.toString(),  message: 'Login successful'  })\n  \n      } catch(error){\n      console.log('Error saving token and storing in cookies', error)\n      res.status(500).json({ message: 'An internal server error occurred' });\n    }\n  } else {\n    res.status(405).json({ message: 'Method not allowed' });\n  }\n}\n\nexport default handler;"]}