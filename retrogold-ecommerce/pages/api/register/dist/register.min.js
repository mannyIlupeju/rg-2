"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _mongodb=require("mongodb"),_bcryptjs=_interopRequireDefault(require("bcryptjs")),_nodemailer=_interopRequireDefault(require("nodemailer")),_User=_interopRequireDefault(require("../../../models/User")),_mongoose=_interopRequireDefault(require("../../../lib/mongoose")),_uuid=require("uuid"),_dotenv=_interopRequireDefault(require("dotenv"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}_dotenv.default.config();var verificationCode=(0,_uuid.v4)(),transporter=_nodemailer.default.createTransport({service:"gmail",auth:{user:process.env.EMAIL_USERNAME,pass:process.env.EMAIL_PASSWORD}});function handler(r,t){var s,a,n,u,o,i,d,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("POST"!==r.method){e.next=29;break}if(s=r.body,a=s.email,n=s.name,u=s.password,o=s.retype,n&&"string"==typeof n){e.next=4;break}return e.abrupt("return",t.status(422).json({message:"Please provide a valid name"}));case 4:if((i=a.toLowerCase().trim())&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){e.next=7;break}return e.abrupt("return",t.status(422).json({message:"Please enter a correct email address"}));case 7:if(u!==o)return e.abrupt("return",t.status(422).json({message:"Passwords do not match"}));e.next=9;break;case 9:return e.next=11,regeneratorRuntime.awrap(_bcryptjs.default.hash(u,10));case 11:return d=e.sent,e.prev=12,e.next=15,regeneratorRuntime.awrap(_User.default.findOne({email:i}));case 15:if(e.sent)return e.abrupt("return",t.status(400).json({success:!1,message:"User already exists"}));e.next=18;break;case 18:return e.next=20,regeneratorRuntime.awrap(_User.default.create({name:n,email:i,password:d,role:"user"}));case 20:l=e.sent,t.status(201).json({success:!0,data:l,message:"Signed up! A verification email has been sent to your email address"}),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(12),t.status(500).json({message:"User not created",error:e.t0.message});case 27:e.next=30;break;case 29:t.status(405).json({success:!1,message:"Method not allowed"});case 30:case"end":return e.stop()}},null,null,[[12,24]])}(0,_mongoose.default)();var _default=handler;exports.default=_default;
//# sourceMappingURL=register.min.js.map
