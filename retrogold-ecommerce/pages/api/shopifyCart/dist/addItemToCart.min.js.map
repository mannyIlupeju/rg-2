{"version":3,"sources":["addItemToCart.js"],"names":["_nodeFetch","_interopRequireDefault","require","handler","req","res","_req$body","cartId","lineItems","response","data","regeneratorRuntime","async","_context","prev","next","method","body","console","log","awrap","process","cartLinesAdd","error","Content-Type","X-Shopify-Storefront-Access-Token","env","SHOPIFY_PUB","JSON","stringify","query","variables","lines","sent","json","status","userErrors","length","t0","setHeader","end","concat","stop"],"mappings":"4FAAA,IAAAA,WAAAC,uBAAAC,QAAA,uFAEe,SAAeC,QAAQC,EAAKC,GAA5B,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GACQ,SAAfX,EAAIY,OADG,OAAAH,EAAAC,KAAA,EAAAR,EAG2BF,EAAIa,KAA1BV,EAHLD,EAGKC,OAAQC,EAHbF,EAGaE,UAChBU,QAAQC,IAAIZ,EAAQC,GAJjB,4uDAAAK,EAAAE,KAAA,EAAAJ,mBAAAS,OAoEmBV,EAAAA,WAAAA,SAAAA,WAAAA,OAAlBW,QAA4CX,IAAKY,eAA/BZ,6BAAwD,CACtEA,OAAKA,OACLQ,QAAQK,CACXC,eAAA,mBACEC,oCAAAJ,QAAAK,IAAAC,aAENV,KAAAW,KAAAC,UAAA,CAjBOC,MAzDL,4uDAAAC,UAAA,CAAAxB,OAAAA,EAAAyB,MAAAxB,QAAAK,EAAAE,KAAA,GAAA,MAAA,KAAA,EAAA,OAoEKN,EApELI,EAAAoB,KAAApB,EAAAE,KAAA,GAAAJ,mBAAAS,MA6EHX,EAAAyB,QA7EG,KAAA,GA6EKX,EA7ELV,EAAAoB,KA8EH5B,EAAI8B,OAAO,KAAKD,KAAKxB,GAVjBA,EAAKA,MAAQA,EAAKA,KAAKY,cAAgBZ,EAAKA,KAAKY,aAAac,WApE/D,EAAA1B,EAAAA,KAAAY,aAAAc,WAAAC,QAAAnB,QAAAK,MAAA,eAAAb,EAAAA,KAAAY,aAAAc,YAAAlB,QAAAK,MAAA,iCAAAb,GAAAG,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAyB,GAAAzB,EAAA,MAAA,GAAAK,QAAAK,MAAAV,EAAAyB,IAAAjC,EAAA8B,OAAA,KAAAD,KAAA,CAAAX,MAAA,+BAAA,KAAA,GAAAV,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAV,EAAAkC,UAAA,QAAA,CAAA,SAAAlC,EAAA8B,OAAA,KAAAK,IAAA,UAAAC,OAAArC,EAAAY,OAAA,iBAAA,KAAA,GAAA,IAAA,MAAA,OAAAH,EAAA6B,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA","file":"addItemToCart.min.js","sourcesContent":["import fetch from 'node-fetch';\n\nexport default async function handler(req, res) {\n    if (req.method === \"POST\") {\n        try {\n            const { cartId, lineItems } = req.body;\n            console.log(cartId, lineItems);\n\n            const query = `\n                mutation addCartLines($cartId: ID!, $lines: [CartLineInput!]!) {\n                    cartLinesAdd(cartId: $cartId, lines: $lines) {\n                        cart {\n                            id\n                            lines(first: 10) {\n                                edges {\n                                    node {\n                                        quantity\n                                        merchandise {\n                                            ... on ProductVariant {\n                                                id\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                            cost {\n                                totalAmount {\n                                    amount\n                                    currencyCode\n                                }\n                                subtotalAmount {\n                                    amount\n                                    currencyCode\n                                }\n                                totalTaxAmount {\n                                    amount\n                                    currencyCode\n                                }\n                                totalDutyAmount {\n                                    amount\n                                    currencyCode\n                                }\n                            }\n                        }\n                        userErrors {\n                            field\n                            message\n                        }\n                    }\n                }\n            `;\n\n            const response = await fetch(`https://${process.env.SHOPIFY_DOMAIN}/api/2023-10/graphql.json`, {\n                method: \"POST\",\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-Shopify-Storefront-Access-Token': process.env.SHOPIFY_PUB\n                },\n                body: JSON.stringify({\n                    query,\n                    variables: { cartId, lines: lineItems }\n                })\n            })\n\n            \n            \n            const data = await response.json();\n            res.status(200).json(data)\n\n            // Check if cartLinesAdd is available and has userErrors\n            if (data.data && data.data.cartLinesAdd && data.data.cartLinesAdd.userErrors) {\n                if (data.data.cartLinesAdd.userErrors.length > 0) {\n                    console.error('User errors:', data.data.cartLinesAdd.userErrors);\n                }\n            } else {\n                console.error('Unexpected response structure:', data);\n            }\n\n        } catch (error) {\n            console.error(error);\n            res.status(500).json({ error: 'Error adding items to cart' })\n        }\n    } else {\n        res.setHeader('Allow', ['POST']);\n        res.status(405).end(`Method ${req.method} Not Allowed`);\n    }\n}"]}