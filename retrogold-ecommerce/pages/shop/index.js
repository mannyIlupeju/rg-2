import React, {useState} from 'react';
import Head from 'next/head'
import { sanityClient } from '/lib/sanity'
import {urlFor} from '/lib/sanity'
import Navigation from '@/components/Shared/Navigation'
import Footer from '@/components/Shared/Footer/footer'
import Link from 'next/link'


const Shop = ({shop}) => {
  const[isHovered, setIsHovered] = useState(null)
  
  //Destructuring shop object
  const[a,b,c] = shop 
  const [...arr] = [a,b,c]
 

  const shopImage = {
    width: '320px',
    height: '320px',
    borderRadius: '0.5rem'
  }


  const handleMouseEnter = (_id) => {
     setIsHovered(_id)
  } 

  const handleMouseLeave = (e) => {
    setIsHovered(null)  
  }


  

  

  
  return (
    <>
      <Head>
        <title>Shop</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Navigation/>

      <main>
      <div className="bg-white flex flex-col md:flex-row gap-28 p-24 justify-center">
          {...arr.map((shopItems)=>{
            const{brandName, _id, slug, images, mainImage, mainImage2, productName, price, productDescription, shortDescription} = shopItems
            
         
            return (

              <>
                <Link href={`/shop/${slug.current}`} key={_id}>
                  <div className="text-zinc-700 cursor-pointer" key={_id} >
                    <div className="">
                      <div onMouseEnter={()=> handleMouseEnter(_id)} onMouseLeave={handleMouseLeave}  id={_id}>
                      <img src={ isHovered === _id ? urlFor(mainImage2.asset._ref) : urlFor(mainImage.asset._ref)} alt="" style={shopImage}/> 
                      </div>

                      <div className="mt-2">
                        <p className="text-sm">{brandName}</p>
                        <p className="font-bold">{productName}</p>
                        <p>${price}</p>

                        <div style={shopImage} className="line-clamp-4 mt-4">
                          <p className="text-sm text-bold">
                            {shortDescription.map((x)=>{
                              return x.children[0].text
                            })}
                          </p>
                        </div>
                      </div>
                    </div>
                
                  </div>
                </Link>
              </>
            )
          })}
      </div>
      </main>
      <Footer/>
    </>
  );
}

export default Shop;



const shopQuery = `*[_type == "product"]{
  brandName, 
  _id,
  slug,
  images,
  mainImage, 
  mainImage2,
  price, 
  productName,
  shortDescription,
  productDescription
}`

export async function getStaticProps() {
  const shop = await sanityClient.fetch(shopQuery)

  return {  
    props: {
      shop
    }
  }
}